<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN' 'http://www.w3.org/TR/html4/strict.dtd'>
{% load staticfiles %}
<html>
<head>
    <meta http-equiv='Content-Type' content='text/html; charset=utf-8'>
    <title>Datastream Test</title>
    <link rel='stylesheet' type='text/css' href='{% static "test_app/style.css" %}' media='screen'/>
    <script type='text/javascript' src='{% static "test_app/jquery/jquery.js" %}'></script>
    {% comment %}
    <script type='text/javascript' src='{% static "pushserver/updates.js" %}'></script>
    {% endcomment %}
    <script type='text/javascript' src='{% static "test_app/flot/jquery.flot.js" %}'></script>
    <script type='text/javascript' src='{% static "test_app/flot/jquery.flot.selection.js" %}'></script>
    <script type='text/javascript' src='{% static "test_app/flot/jquery.flot.navigate.js" %}'></script>
    <script type='text/javascript' src='{% static "test_app/flot/jquery.flot.crosshair.js" %}'></script>
    <script type='text/javascript' src='{% static "test_app/js/datastream.js" %}'></script>
</head>
<body>
    <div id='content'>
        <h1>Datastream Test</h1>

        <p>Left-click and drag to pan. Right-click and drag for zoom.
            Right-click
            for zoom-out.</p>
        <p>TODO: pan on horizontal scroll, vertical scroll to change granularity.</p>
        <h2>Example 1: one pixel one value</h2>
        <p>Default mode displays one value per pixel. It is activated by default
           or on vertical scroll.</p>
        <p><select id='selectmetric' width='200px'></select>
           <button id='addmetric'>add metric</button>
           <button id='addplot'>add plot</button>
           <span id='step'></span></p>
        <div id='placeholder'></div>
        <h2>Example 2: fixed interval</h2>
        <p>Alternative mode of the datastream plot is to display a time series
            in a fixed time interval. The mode is activated if you
            specify the <i>from</i> setting or when you zoom to an interval
            (right-click + drag).</p>
        <p><select id='selectmetric_alt' width='200px'></select>
           <button id='addmetric_alt'>add metric</button>
           <button id='addplot_alt'>add plot</button>
           <span id='step_alt'></span></p>
        <div id='placeholder_alt'></div>
        {% if debug %}
        <div id='debug'>
            <h3>DEBUG INFO</h3>
            <table id="debugTable">
                <tr>
                    <td>Metric</td>
                    <td>Granularity</td>
                    <td>From</td>
                    <td>To</td>
                    <td>Elements</td>
                </tr>
            </table>
        </div>
        {% endif %}
    </div>
    <script type="text/javascript">
        $(document).ready(function () {

            if (!$('#debug').length) {
                $(document).ajaxError(function (event, jqXHR, ajaxSettings, thrownError) {
                    window.console.error(event, jqXHR, ajaxSettings, thrownError);
                    alert("Oops, something went wrong...");
                });
            }

            $('#addmetric_alt').click(function () {
                $('#' + $.datastream.currentId()).datastream({
                    'add_metric': $('#selectmetric_alt').val()
                });
            });

            $('#addplot_alt').click(function () {
                $('#placeholder_alt').datastream({
                    'metrics': [ $('#selectmetric_alt').val() ]
                });
            });

            $.datastream.metricList(function (metrics) {
                $('#selectmetric option').remove();
                $('#selectmetric_alt option').remove();

                $.each(metrics, function (i, metric) {
                    $('#selectmetric')
                        .append($('<option>', { 'value': metric.id })
                        .text($.datastream.metricName(metric)));
                });

                $.each(metrics, function (i, metric) {
                    $('#selectmetric_alt')
                            .append($('<option>', { 'value': metric.id })
                            .text($.datastream.metricName(metric)));
                });

                $('#placeholder').datastream({
                    'metrics': [ $('#selectmetric').val() ]
                });

                $('#placeholder_alt').datastream({
                    'metrics': [ $('#selectmetric_alt').val() ]
                });
            });
        });
    </script>
</body>
</html>